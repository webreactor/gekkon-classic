# Шаблоны Gekkon

Шаблон при помощи класса Gekkon компилируется в php файл и сохраняется в отдельную папку

Во время вызова шаблона проверяется наличие его откомпилированной версии.
Если файл откомпилирован то вызывается откомпилированная версия.
Иначе файл компилируется а потом вызываетя откомпилированная версия.

Также файл будет перекомпилирован если его изменить

Работа с откомпилированными версиями происходит прозрачно, вызывается только файл шаблона.

Пример подключения -

```
{
    "repositories": [
        {
            "type": "vcs",
            "url": "git@github.com:webreactor/gekkon-classic.git"
        }
    ],
    "require": {
        "webreactor/gekkon-classic": "dev-master"
    }
}

```

```
error_reporting(E_ALL);
ini_set("display_errors", 1);
require 'vendor/autoload.php';

$Gekkon=new \Reactor\Gekkon\Gekkon(__dir__.'/tpl/', __dir__.'/tpl_bin/');

$Gekkon->register('data', $_SERVER);
$Gekkon->display('demo.tpl');

```

Дайте доступ на запись вебсерверу на папку tpl_bin

`chmod a+x tpl_bin`


## Свойства класса
```
$temlate_path; - путь к папке с шаблонами (необходим доступ на чтение)
$bin_path; - путь к папке с компилироваттыми шаблонами (необходим доступ на чтение и запись)
$gekkon_path; - путь к папке с Gekkon
```
Все пути должны оканчиваться на /

После создания обьекта - свойства можно переопределить пользовательские свойства.
Это может понадобиться что бы держать шаблоны в разных модулях и менять базовый путь шаблона в процессе работы.

```
register($name,$value) - регистрирует переменную $value в шаблонизаторе
Тип переменной может быть любой с именем $name при этом создается копия переменной!!!

registers($name,$value) - тоже самое что и register($name,$value), только переменная регистрируется как указатель на существующую переменную

display($file_name) - показывает шаблон с именем $file_name 
Путь к шаблону строится относительно $template_path
Перед показом шаблона необходимо методами register[s] определить все переменные которые
будут использоваться в шаблоне

compile_file($file_name) - откомпилировать файл file_name без вывода его на экран

compile_virtual_file($virt_name,$file_name) - откомпилировать файл file_name без вывода его на экран, 
потом его можно будет вызвать по имени несуществующего шаблона virt_name 
```

## Переменные шаблонизатора. Работа с зарегистрированной переменной
Переменые начинаются на знак $
- $a - переменная а

## работа с массивом
```
$a.1 - возвращает ячейку массива с индексом 1
$a.key - работа с хеш массивом
$a.$b - ключ тоже может быть переменной
```

## Более сложные варианты. Gekkon => php эквивалент
```
$a.1.2 => $a[1][2]
$a.$b.$c => $a[$b][$с]

$a.$b&$c =>$a[$b[$c]]
$a.$b&$c.$d =>$a[$b[$c]][$d]

$var.func() => func($var) - где функция с одним параметром
$a.strlen() => strlen($a)
$a.isset() => isset($a)
```

После метода .func() - можно использовать другие методы, например: 
```
$a.funk().print_r()
$var->a - доступ к свойству класса
$var->a() - доступ к методу класса - параметры метода не тестировал но тоже должны работать.
```
для доступа к методам с параметрами используйте управляющий тег set

## Теги шаблонизатора

### Вывод
Для вывода возвращаемого значения на экран используются { }
пример: 
```
1. {$a} {$a.1} {$a.count()} и тд. Можно использовать выражение пример - {$a +1} {$a + $b}

2. {$a.$b} и {$a . $b}

Обратите внимание, в первом случае работа с массивом в переменной $a во втором работа со строками
```

Внимание! Переменные шаблонизатора должны обрамляться пробелами!!

## Управляющие теги 
Все управляющие теги содержатся внутри кострукции 
```
<!-- TAG -->
```

Теги могут быть закрывающиеся и незакрывающиеся
```
закрывающийся - <!-- tag_name --> something  <!--/tag_name-->
незакрывающийся - <!-- tag_name -->
```

Параметры управляющих тегов
```
<!-- tag_name XXX -->

XXX здесь могут быть парамеры тега
```

Параметры могуть быть стандартного вида name=value name=value или если у тебя один параметр и это описанно в описании тега то name будет отсутствовать
в параметрах стандартного вида value может быть как переменной, так и константным значением
Примеры:
```
<!-- tag_name param=constant_text -->
<!-- tag_name param="constant text" -->
<!-- tag_name param="constant 'text" -->
<!-- tag_name param='constant "text' -->
<!-- tag_name param=$var -->
<!-- tag_name param=$var.1 -->
и т.д.
```

Порядок следования параметров значения не имеет

## Основные теги
### comment
незакрывающийся, поскольку кострукция тега совпадает с стандартным комментарием html,
то чтобы внести комментарий в текст необходимо внести его в тег comment.
Пример
```
<!-- comment text text text -->
```

### include
незакрывающийся, подключение шаблона. 
Пример
```
<!-- include file_name -->
<!-- include $var -->
```
Путь к шаблону строится относительно свойства класса $template_path

### if
закрывающийся, синтаксис условия идентичен php. 
Внимание переменные шаблонизатора должны обрамляться пробелами!!
```
<!--if $a =='text' and $b.1 ==123-->
some thing 1
<!--/if-->

или

<!--if $a =='text' and $b.1 ==123-->
some thing 1
<!--else-->
some thing 2
<!--/if-->
```

### foreach
закрывающийся, перебор значений массива.
Пример 1
```
<!--foreach from=$data item=$v-->
some thing 1 {$v}
<!--/foreach-->

рнр эквивалент

foreach($data as $v)
{
echo 'some thing 1 ',$v;
}
```

Пример 2
```
<!--foreach from=$data item=$v key=$k -->
some thing 2 {$k}={$v}
<!--/foreach-->

рнр эквивалент

foreach($data as $k => $v)
{
echo 'some thing 2 ',$k,'=',$v;
}
```

### for
закрывающийся, цикл.
Пример
```
<!--for from=1 to=10 key=$k -->
{$k}
<!--/for-->

рнр эквивалент

for($k=1;$k<10;$k++)
{
echo $k;
}
```

необязательный параметр step - по умолчанию равный 1


### set
незакрывающийся, присваивание переменной.
Синтаксис обычного рнр выражения. Внимание переменные шаблонизатора должны обрамляться пробелами!!
Пример
```
<!--set $a =1 -->
<!--set $a = $b +4-->
<!--set $a.key = $b.5 -->
<!--set $a =$b->method('p1', $d ) + $e -->

и тд.
```

### php
закрывающийся, вставка прямого php текста.
Доступ к переменным шаблонизатора можно получить из массива $this->data['var_name']
где var_name - название переменной.
Пример
```
<!--php-->
php code
<!--/php-->
```


### cache
закрывающийся, команда компилятору шаблона - все содержимое тега надо не только откомпилировать но и выполнить
тоесть содержиное тега после компиляции превращается в чистый html
